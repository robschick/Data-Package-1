---
title: "Gonio"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
library(dplyr)
library(readr)
```

## R Markdown

```{r gonio}
gonio <- read_csv('gonio_gpx_merge_2019.csv')
gonio <- gonio %>%
  mutate(date = as.character(date))

gonio <- gonio %>%
  mutate(date_time = parse_datetime(date, format = "%Y-%m-%d %H:%M:%S", locale = locale(tz = 'UTC'))) %>%
  filter(!gps_gonio_time_difference_s > 60,
        strength_db < 0)
 
gonio$gap <- c(0, diff(gonio$date_time) > 120)
gonio$group <- cumsum(gonio$gap) + 1
 
gonio_out <- gonio %>%
  group_by(DeployID, group) %>%
  filter(strength_db == max(strength_db)) %>%
  select(platform, DeployID, date_time, lon, lat, group, strength_db)
 
gonio_out <- gonio_out %>%
  group_by(DeployID, group) %>%
  slice_head()

print(gonio_out)
```
